# Docker Compose override for debugging
# Usage: docker-compose -f docker-compose.yml -f docker-compose.debug.yml up

services:
  # Azure Functions with debugging enabled
  functions:
    build:
      context: ..
      dockerfile: docker/Dockerfile.debug
    ports:
      - "7071:80"
      - "5678:5678"  # Debugger port
    environment:
      # Additional debug settings
      DOTNET_USE_POLLING_FILE_WATCHER: "true"
      Logging__LogLevel__Default: "Debug"
      Logging__LogLevel__Microsoft: "Information"
      Logging__LogLevel__Microsoft.Hosting.Lifetime: "Information"
    volumes:
      # Mount source code for hot reload
      - ../src:/src/src:cached
    command: >
      sh -c "cd /src/src/RYG.Functions &&
             dotnet restore &&
             dotnet build --no-restore &&
             dotnet run --no-build --no-launch-profile"

  # SignalR Hub with debugging enabled
  signalr-hub:
    build:
      context: ..
      dockerfile: docker/Dockerfile.signalr.debug
    ports:
      - "5000:80"
      - "5679:5679"  # Debugger port (different from functions)
    environment:
      ASPNETCORE_ENVIRONMENT: "Development"
      DOTNET_USE_POLLING_FILE_WATCHER: "true"
      Logging__LogLevel__Default: "Debug"
      Logging__LogLevel__Microsoft: "Information"
      Logging__LogLevel__Microsoft.Hosting.Lifetime: "Information"
    volumes:
      # Mount source code for hot reload
      - ../src:/src/src:cached
    command: >
      sh -c "cd /src/src/RYG.SignalRHubHost &&
             dotnet restore &&
             dotnet build --no-restore &&
             dotnet run --no-build --no-launch-profile"
